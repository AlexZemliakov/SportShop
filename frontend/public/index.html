<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SportShop - Магазин спортивного питания</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="main-container">
    <header class="main-header">
        <h1>SportShop</h1>
        <p>Лучший протеин только у нас</p>
        <nav>
            <a href="/admin">Админ-панель</a>
        </nav>
    </header>

    <div id="categories-view">
        <div id="categories-nav" class="categories-nav">
            <div class="category all-categories" onclick="loadAllProducts()">Все товары</div>
            <!-- Категории будут загружены через JavaScript -->
        </div>

        <main class="product-grid">
            <h2 id="category-title">Наши товары</h2>
            <div class="products-container" id="productsContainer">
                <!-- Товары будут загружены через JavaScript -->
                <div class="loading">Загрузка товаров...</div>
            </div>
        </main>
    </div>

    <footer class="main-footer">
        <p>© SportShop - быстро, надежно, качественно.</p>
    </footer>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadCategories();
        loadAllProducts();
    });

    // Загрузка всех товаров
    async function loadAllProducts() {
        document.getElementById('category-title').textContent = 'Все товары';
        document.querySelector('.all-categories').classList.add('active');
        document.querySelectorAll('.category:not(.all-categories)').forEach(c => c.classList.remove('active'));

        try {
            const response = await fetch('/api/products');
            const products = await response.json();
            displayProducts(products);
        } catch (error) {
            console.error('Ошибка загрузки товаров:', error);
            document.getElementById('productsContainer').innerHTML =
                '<div class="error">Ошибка загрузки товаров</div>';
        }
    }

    // Загрузка товаров по категории
    async function loadProductsByCategory(categoryId) {
        try {
            const response = await fetch(`/api/categories/${categoryId}/products`);
            if (!response.ok) throw new Error('Ошибка загрузки товаров');
            const products = await response.json();

            // Обновляем заголовок и активную категорию
            document.getElementById('category-title').textContent =
                document.querySelector(`.category[data-id="${categoryId}"]`).textContent;

            document.querySelectorAll('.category').forEach(c => c.classList.remove('active'));
            document.querySelector(`.category[data-id="${categoryId}"]`).classList.add('active');

            displayProducts(products);
        } catch (error) {
            console.error('Ошибка загрузки товаров:', error);
            document.getElementById('productsContainer').innerHTML =
                '<div class="error">Ошибка загрузки товаров</div>';
        }
    }

    // Отображение товаров
    function displayProducts(products) {
        const container = document.getElementById('productsContainer');

        if (products.length === 0) {
            container.innerHTML = '<div class="empty">Товары отсутствуют</div>';
            return;
        }

        container.innerHTML = products.map(product => `
        <div class="product-card" data-product-id="${product.id}">
            <div class="product-image">
                ${product.image_url ?
                    `<img src="${product.image_url}" alt="${product.name}">` :
                    '<div class="no-image">Нет изображения</div>'}
            </div>
            <div class="product-info">
                <h3>${product.name}</h3>
                <div class="product-price">${product.price.toFixed(2)} ₽</div>
                <button class="btn-cart">В корзину</button>
            </div>
        </div>
        </div>
    `).join('');
    }

    // Загрузка категорий
    async function loadCategories() {
        try {
            const response = await fetch('/api/categories');
            if (!response.ok) throw new Error('Ошибка загрузки категорий');
            const categories = await response.json();

            const nav = document.getElementById('categories-nav');
            nav.innerHTML = '<div class="category all-categories active" onclick="loadAllProducts()">Все товары</div>';

            categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category';
                categoryElement.textContent = category.name;
                categoryElement.setAttribute('data-id', category.id);
                categoryElement.onclick = () => loadProductsByCategory(category.id);
                nav.appendChild(categoryElement);
            });
        } catch (error) {
            console.error('Ошибка загрузки категорий:', error);
            document.getElementById('categories-nav').innerHTML =
                '<div class="error">Ошибка загрузки категорий</div>';
        }
    }

    // Просмотр деталей товара
    async function showProductDetail(productId) {
        try {
            const response = await fetch(`/api/products/${productId}`);
            if (!response.ok) throw new Error('Product not found');
            const product = await response.json();

            // Создаем модальное окно для показа товара
            const modal = document.createElement('div');
            modal.className = 'product-modal';
            modal.innerHTML = `
            <div class="modal-content">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <div class="product-image">
                    ${product.image_url ?
                `<img src="${product.image_url}" alt="${product.name}">` :
                '<div class="no-image">No image</div>'}
                </div>
                <h2>${product.name}</h2>
                <p class="price">${product.price.toFixed(2)} ₽</p>
                <p class="description">${product.description}</p>
                <p class="stock">Остаток: ${product.stock} шт.</p>
                <button onclick="addToCart(${product.id})">В корзину</button>
            </div>
        `;
            document.body.appendChild(modal);
        } catch (error) {
            console.error('Error:', error);
            alert('Не удалось загрузить товар');
        }
    }
</script>
</body>
</html>