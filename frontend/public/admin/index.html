<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | SportShop</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      background-color: #1e1e1e;
      color: #ffffff;
    }

    .admin-header {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #333333;
    }

    .admin-header h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #2ecc71;
    }

    .admin-header nav a {
      color: #3498db;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      transition: background-color 0.3s;
    }

    .admin-header nav a:hover {
      background-color: rgba(52, 152, 219, 0.1);
    }

    /* –°—Ç–∏–ª–∏ –≤–∫–ª–∞–¥–æ–∫ */
    .admin-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #333333;
    }

    .admin-tab {
      padding: 12px 24px;
      cursor: pointer;
      background-color: #34495e;
      color: #ecf0f1;
      margin-right: 8px;
      border-radius: 6px 6px 0 0;
      transition: all 0.3s ease;
      font-weight: 500;
      border: 1px solid transparent;
    }

    .admin-tab.active {
      background-color: #2ecc71;
      color: #fff;
      border-color: #27ae60;
      box-shadow: 0 2px 5px rgba(46, 204, 113, 0.3);
    }

    .admin-tab:hover:not(.active) {
      background-color: #3d566e;
      color: #fff;
    }

    /* –°—Ç–∏–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–∫–ª–∞–¥–æ–∫ */
    .tab-content {
      display: none;
      padding: 20px;
      background-color: #2c3e50;
      border-radius: 0 6px 6px 6px;
      margin-top: -1px;
    }

    .tab-content.active {
      display: block;
    }

    /* –§–æ—Ä–º—ã */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #ecf0f1;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem;
      background-color: #34495e;
      border: 1px solid #3d566e;
      border-radius: 4px;
      color: #ecf0f1;
      font-size: 1rem;
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      font-size: 1rem;
    }

    .btn-primary {
      background-color: #3498db;
      color: white;
    }

    .btn-primary:hover {
      background-color: #2980b9;
    }

    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }

    .btn-danger:hover {
      background-color: #c0392b;
    }

    .btn-edit {
      background-color: #f39c12;
      color: white;
      margin-right: 0.5rem;
    }

    .btn-edit:hover {
      background-color: #d35400;
    }

    /* –¢–∞–±–ª–∏—Ü—ã */
    .table-container {
      overflow-x: auto;
      margin-top: 2rem;
      background-color: #2c3e50;
      border-radius: 6px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #3d566e;
    }

    th {
      background-color: #34495e;
      font-weight: 600;
      color: #ecf0f1;
    }

    tr:hover {
      background-color: rgba(52, 152, 219, 0.1);
    }

    /* –°–æ–æ–±—â–µ–Ω–∏—è */
    .empty, .error {
      padding: 1rem;
      text-align: center;
      color: #bdc3c7;
      background-color: #34495e;
      border-radius: 4px;
      margin: 1rem 0;
    }

    .error {
      color: #e74c3c;
    }
  </style>
</head>
<body>
<div class="admin-container">
  <header class="admin-header">
    <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å SportShop</h1>
    <nav>
      <a href="/">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </nav>
  </header>

  <div class="admin-tabs">
    <div class="admin-tab active" data-tab="products">–¢–æ–≤–∞—Ä—ã</div>
    <div class="admin-tab" data-tab="categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
  <div id="productsTab" class="tab-content active">
    <div class="add-product-form">
      <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
      <input type="hidden" id="editProductId">
      <div class="form-group">
        <label for="productName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
        <input type="text" id="productName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required>
      </div>
      <div class="form-group">
        <label for="productDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea id="productDescription" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required></textarea>
      </div>
      <div class="form-group">
        <label for="productPrice">–¶–µ–Ω–∞</label>
        <input type="number" id="productPrice" placeholder="0.00" step="0.01" min="0" required>
      </div>
      <div class="form-group">
        <label for="productStock">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
        <input type="number" id="productStock" placeholder="0" min="0" required>
      </div>
      <div class="form-group">
        <label for="productImage">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
        <input type="text" id="productImage" placeholder="https://example.com/image.jpg">
      </div>
      <div class="form-group">
        <label for="productCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="productCategory">
          <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        </select>
      </div>
      <div class="form-actions">
        <button class="btn btn-primary" id="saveProductBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
        <button class="btn btn-danger" id="cancelEditBtn" style="display: none;">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>

    <div class="product-list">
      <h2>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h2>
      <div class="form-group">
        <label for="productCategoryFilter">–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
        <select id="productCategoryFilter" class="form-control">
          <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        </select>
      </div>
      <div class="table-container">
        <table id="productsTable">
          <thead>
          <tr>
            <th>ID</th>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–¶–µ–Ω–∞</th>
            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
  <div id="categoriesTab" class="tab-content">
    <div class="add-category-form">
      <h2>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
      <input type="hidden" id="editCategoryId">
      <div class="form-group">
        <label for="categoryName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
        <input type="text" id="categoryName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" required>
      </div>
      <div class="form-group">
        <label for="categoryDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea id="categoryDescription" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"></textarea>
      </div>
      <div class="form-group">
        <label for="categoryImage">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
        <input type="text" id="categoryImage" placeholder="https://example.com/category.jpg">
      </div>
      <div class="form-actions">
        <button class="btn btn-primary" id="saveCategoryBtn">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
        <button class="btn btn-danger" id="cancelEditCategoryBtn" style="display: none;">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>

    <div class="category-list">
      <h2>–°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h2>
      <div class="table-container">
        <table id="categoriesTable">
          <thead>
          <tr>
            <th>ID</th>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
  document.querySelectorAll('.admin-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

      tab.classList.add('active');
      document.getElementById(`${tab.dataset.tab}Tab`).classList.add('active');

      if (tab.dataset.tab === 'categories') {
        loadCategories();
      } else {
        loadProducts();
      }
    });
  });

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤
  async function loadCategoriesForSelect() {
    try {
      const response = await fetch('/api/categories');
      const categories = await response.json();

      const productCategorySelect = document.getElementById('productCategory');
      const filterCategorySelect = document.getElementById('productCategoryFilter');

      // –û—á–∏—â–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏–∏
      productCategorySelect.innerHTML = '<option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';
      filterCategorySelect.innerHTML = '<option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';

      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category.id;
        option.textContent = category.name;
        productCategorySelect.appendChild(option.cloneNode(true));
        filterCategorySelect.appendChild(option);
      });
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
      showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
    }
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
  async function loadProducts(categoryId = null) {
    try {
      const url = categoryId && categoryId !== 'all'
              ? `/api/categories/${categoryId}/products`
              : '/api/products';

      const response = await fetch(url);
      if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
      const products = await response.json();

      const tbody = document.querySelector('#productsTable tbody');
      tbody.innerHTML = '';

      if (products.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="empty">–¢–æ–≤–∞—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</td></tr>';
        return;
      }

      products.forEach(product => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${product.id}</td>
          <td>${product.name}</td>
          <td>${product.description || '-'}</td>
          <td>${product.price.toFixed(2)} ‚ÇΩ</td>
          <td>${product.stock}</td>
          <td>${getCategoryName(product.category_id)}</td>
          <td>
            <button class="btn btn-edit" onclick="editProduct(${product.id})">‚úèÔ∏è</button>
            <button class="btn btn-danger" onclick="deleteProduct(${product.id})">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error);
      document.querySelector('#productsTable tbody').innerHTML =
              '<tr><td colspan="7" class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</td></tr>';
    }
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  function getCategoryName(categoryId) {
    if (!categoryId) return '-';
    const select = document.getElementById('productCategory');
    const option = select.querySelector(`option[value="${categoryId}"]`);
    return option ? option.textContent : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  async function loadCategories() {
    try {
      const response = await fetch('/api/categories');
      if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
      const categories = await response.json();

      const tbody = document.querySelector('#categoriesTable tbody');
      tbody.innerHTML = '';

      if (categories.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="empty">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</td></tr>';
        return;
      }

      categories.forEach(category => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${category.id}</td>
          <td>${category.name}</td>
          <td>${category.description || '-'}</td>
          <td>
            <button class="btn btn-edit" onclick="editCategory(${category.id})">‚úèÔ∏è</button>
            <button class="btn btn-danger" onclick="deleteCategory(${category.id})">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
      document.querySelector('#categoriesTable tbody').innerHTML =
              '<tr><td colspan="4" class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</td></tr>';
    }
  }

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  document.getElementById('productCategoryFilter').addEventListener('change', function() {
    loadProducts(this.value);
  });

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  document.getElementById('saveProductBtn').addEventListener('click', async function() {
    const productId = document.getElementById('editProductId').value;
    const product = {
      name: document.getElementById('productName').value.trim(),
      description: document.getElementById('productDescription').value.trim(),
      price: parseFloat(document.getElementById('productPrice').value),
      stock: parseInt(document.getElementById('productStock').value),
      image_url: document.getElementById('productImage').value.trim() || null,
      category_id: document.getElementById('productCategory').value || null
    };

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!product.name || !product.description || isNaN(product.price) || isNaN(product.stock)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
      return;
    }

    const url = productId ? `/api/products/${productId}` : '/api/products';
    const method = productId ? 'PUT' : 'POST';

    try {
      const response = await fetch(url, {
        method: method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(product)
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
      }

      resetProductForm();
      loadProducts(document.getElementById('productCategoryFilter').value);
      showSuccess(productId ? '–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω' : '–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω');
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:', error);
      showError(error.message || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞');
    }
  });

  // –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
  document.getElementById('cancelEditBtn').addEventListener('click', resetProductForm);

  function resetProductForm() {
    document.getElementById('editProductId').value = '';
    document.getElementById('productName').value = '';
    document.getElementById('productDescription').value = '';
    document.getElementById('productPrice').value = '';
    document.getElementById('productStock').value = '';
    document.getElementById('productImage').value = '';
    document.getElementById('productCategory').value = '';
    document.getElementById('saveProductBtn').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
    document.getElementById('cancelEditBtn').style.display = 'none';
  }

  // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  async function editProduct(id) {
    try {
      const response = await fetch(`/api/products/${id}`);
      if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
      const product = await response.json();

      document.getElementById('editProductId').value = product.id;
      document.getElementById('productName').value = product.name;
      document.getElementById('productDescription').value = product.description || '';
      document.getElementById('productPrice').value = product.price;
      document.getElementById('productStock').value = product.stock;
      document.getElementById('productImage').value = product.image_url || '';
      document.getElementById('productCategory').value = product.category_id || '';
      document.getElementById('saveProductBtn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
      document.getElementById('cancelEditBtn').style.display = 'inline-block';
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞:', error);
      showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞');
    }
  }

  // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  async function deleteProduct(id) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) {
      try {
        const response = await fetch(`/api/products/${id}`, { method: 'DELETE' });
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
        loadProducts(document.getElementById('productCategoryFilter').value);
        showSuccess('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω');
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:', error);
        showError(error.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞');
      }
    }
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  document.getElementById('saveCategoryBtn').addEventListener('click', async function() {
    const categoryId = document.getElementById('editCategoryId').value;
    const category = {
      name: document.getElementById('categoryName').value.trim(),
      description: document.getElementById('categoryDescription').value.trim() || null,
      image_url: document.getElementById('categoryImage').value.trim() || null
    };

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!category.name) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
      return;
    }

    const url = categoryId ? `/api/categories/${categoryId}` : '/api/categories';
    const method = categoryId ? 'PUT' : 'POST';

    try {
      const response = await fetch(url, {
        method: method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(category)
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
      }

      resetCategoryForm();
      loadCategories();
      loadCategoriesForSelect();
      showSuccess(categoryId ? '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞' : '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞');
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', error);
      showError(error.message || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
    }
  });

  // –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  document.getElementById('cancelEditCategoryBtn').addEventListener('click', resetCategoryForm);

  function resetCategoryForm() {
    document.getElementById('editCategoryId').value = '';
    document.getElementById('categoryName').value = '';
    document.getElementById('categoryDescription').value = '';
    document.getElementById('categoryImage').value = '';
    document.getElementById('saveCategoryBtn').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é';
    document.getElementById('cancelEditCategoryBtn').style.display = 'none';
  }

  // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  async function editCategory(id) {
    try {
      const response = await fetch(`/api/categories/${id}`);
      if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
      const category = await response.json();

      document.getElementById('editCategoryId').value = category.id;
      document.getElementById('categoryName').value = category.name;
      document.getElementById('categoryDescription').value = category.description || '';
      document.getElementById('categoryImage').value = category.image_url || '';
      document.getElementById('saveCategoryBtn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
      document.getElementById('cancelEditCategoryBtn').style.display = 'inline-block';
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', error);
      showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
    }
  }

  // –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  async function deleteCategory(id) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é?')) {
      try {
        const response = await fetch(`/api/categories/${id}`, { method: 'DELETE' });
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
        loadCategories();
        loadCategoriesForSelect();
        showSuccess('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞');
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', error);
        showError(error.message || '–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å —Ç–æ–≤–∞—Ä–∞–º–∏');
      }
    }
  }

  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
  function showSuccess(message) {
    alert(message); // –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫—Ä–∞—Å–∏–≤—ã–π toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  }

  function showError(message) {
    alert(message); // –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫—Ä–∞—Å–∏–≤—ã–π toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  document.addEventListener('DOMContentLoaded', function() {
    loadCategoriesForSelect();
    loadProducts();
  });
</script>
</body>
</html>